{% extends 'layout/index.html' %}

{% block css %}
<link rel="stylesheet" href="/stylesheets/style.css" />
{% endblock %}

{% block content %}

    <nav class="navbar navbar-inverse navbar-fixed-top ">
      <div class="container ">
        <div class="navbar-header  ">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand navbar-center" href="#">Chat IO</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse navbar-right">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Chat</a></li>
            <li><a href="/users/login">Login</a></li>
            <li><a href="#" id="username">Username</a></li>
          </ul>
          <form class="navbar-form navbar-left" id="login" role="search">
          <div class="form-group">
            <input type="text" id='name' class="form-control" placeholder="Ingresa tu nombre" maxlength="30" required>
          </div>
          <button type="submit" class="btn btn-default">Log In!</button>
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<div id='viewMain'>

    <div id="messages"></div>
 


   

    <footer class="footer">
    <div class="container-fluid">
    <form id="messagesSubmit"  action="">
    <div class="row"> 
    <input id="m" autocomplete="off" class="col-md-6 col-xs-8" type="text" maxlength="250" required/> <button class="btn btn-primary col-md-3 col-xs-3" id="send">  <span>Send >> </span></button>
    </div>
    </form>
    </div>
    </footer>

</div>

{% endblock %}


  {% block js %}
      <script>
$(document).ready(function() {

$('#messages').css({
  height: $(window).height()-105
});


$(window).on('resize', function(){

$('#messages').css({
  height: $(window).height()-105
});


});


});   

      </script>

      <script>
 var socketChat = io('http://{{ip}}:{{port}}/chat');

 $('#login').submit(function(){
    socketChat.emit('login', $('#name').val());
    $( "#username" ).text($('#name').val())
    $('#login').hide(1000)
    return false;
  });



    $('#messagesSubmit').submit(function(){
    socketChat.emit('chat message', $('#m').val());
    $('#m').val('');
    return false;
  });

   
   socketChat.on('chat message', function(msg){
         var scollDown;
         if ($('#messages')[0].scrollHeight - $('#messages').scrollTop() <= $('#messages').height()+80  ) {      
           scollDown=true;
        }
        else {
            scollDown=false;
        }

     var color;
     if ($('#name').val()===msg['username']) {
     color = '#FF4652';
     }

    $('#messages').append($('<p style="color:'+color+'">').text(msg['username']+' : '+msg['msg']));
 
    if (scollDown===true) {
       $("#messages").animate({ scrollTop: $('#messages')[0].scrollHeight},50);
    };



 /*   if ($('#messages > p' ).length > 10) {
    $('#messages p:first-child').remove();
    }
  */


  });

</script>
  {% endblock %}